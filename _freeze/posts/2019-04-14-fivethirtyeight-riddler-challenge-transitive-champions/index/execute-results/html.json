{
  "hash": "d065623dfe661306cddbdf1bbf561215",
  "result": {
    "markdown": "---\ntitle: \"FiveThirtyEight Riddler Challenge: ''Transitive Champions''\"\ndate: \"2019-04-14\"\ncategories: [fivethirtyeight riddler, basketball]\nimage: \"https://www2.baylor.edu/wp-content/uploads/2019/04/wbb-natlchamps-apr19-768x384.jpg\"\nexecute: \n  warning: false\n  output: true\n---\n\n\n## The Challenge\n\nThis weekend, I attempted to solve my first FiveThirtyEight Riddler challenge. Many of these challenges require a bit more probability theory than I'm comfortable with, but [this week's classic challenge](https://fivethirtyeight.com/features/how-many-times-a-day-is-a-broken-clock-right/) hit a subject that I care too much about: college basketball national champions and the bragging rights that come from beating the champ:\n\n> On Sunday, the Baylor Lady Bears won the 2019 NCAA women's basketball championship, and on Monday, the Virginia Cavaliers did the same on the men's side. But what about all of the unsung transitive champions? For example, earlier in the season, Florida State beat Virginia, thereby laying claim to a transitive championship for the Seminoles. And Boston College beat Florida State, claiming one for the Eagles. And IUPUI beat Boston College, and Ball State beat IUPUI, and so on and so on. Baylor, meanwhile, only lost once, to Stanford, who lost to five teams, and so on. How many transitive national champions were there this season in the women's and men's games? Or, maybe more descriptively, how many teams weren't transitive national champions? You should include tournament losses in your calculations.\n\nThe author (Oliver Roeder) then supplies links to the results of women's and men's basketball for the 2018-2019 season from [masseyratings.com](https://www.masseyratings.com). On first inspection of the game results, they seem to be in a text format that could be scrapped. In addition, I noticed that the [women's link](https://www.masseyratings.com/scores.php?s=305973&sub=305973&all=1) includes 27,266 games, while the [men's link](https://www.masseyratings.com/scores.php?s=305972&sub=11590&all=1) contains only 6,048. The women's results page includes several junior colleges and even my alma mater [Hastings College](https://twitter.com/hcbroncowbb?lang=en), who I know compete at the NAIA level, not NCAA Division I. The men's results page includes only Division I teams, and since the challenge only mentions Baylor and Virginia, I'm assuming we want to compare Division I transitive champions. I used [another link](https://www.masseyratings.com/scores.php?s=305973&sub=11590&all=1) to pull the women's results for 5,638 Division I games.\n\n## Scraping the game results data\n\nI decided to tackle this challenge using the `tidyverse` family of R packages that can scrap the data and wrangle it into a tidy format for further analysis.\n\nOne major challenge is that I wrote a function to parse the college names and scores from the Massey Rating text. This involves some very gnarly regular expression writing as you can see.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(rvest)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbb_games_process <- function(x){\n  read_html(x) %>% \n    html_node(xpath = '/html/body/pre/text()[1]') %>% \n    html_text() %>% \n    enframe() %>% \n    separate_rows(value, sep = \"\\n\") %>% \n    mutate(value = str_squish(value),\n           game = substring(value, 12),\n           date = ymd(substr(value,1,10)),\n           win_team = str_extract(game, \"^[\\\\@]{0,1}[:alpha:]{1,}[:blank:]{0,1}[:punct:]{0,1}[:blank:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,}[:punct:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,}[:punct:]{0,1}[:alpha:]{0,1}\"),\n           win_pts = as.integer(str_extract(game, \"(?<=[:alpha:]{1,100}[:blank:]{1})[:digit:]{1,3}\")),\n           lose_team = str_extract(game, \"(?<=[:digit:]{1,3}[:blank:]{1})[\\\\@]{0,1}[:alpha:]{1,}[:blank:]{0,1}[:punct:]{0,1}[:blank:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,}[:punct:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,}[:punct:]{0,1}[:alpha:]{0,1}\"),\n           lose_pts = as.integer(str_extract(game, \"(?<=[:digit:]{1,3}[:blank:]{1}[\\\\@]{0,1}[:alpha:]{1,100}[:blank:]{0,1}[:punct:]{0,1}[:blank:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,100}[:punct:]{0,1}[:alpha:]{0,1}[:blank:]{0,1}[:alpha:]{1,100}[:punct:]{0,1}[:alpha:]{0,1}[:blank:]{1})[:digit:]{1,3}\"))) %>% \n    select(-name, -value) %>% \n    filter(!is.na(date)) %>% \n    mutate(home_team = if_else(str_detect(win_team, \"\\\\@\"), win_team, \n                               if_else(str_detect(lose_team, \"\\\\@\"), lose_team, \"Neutral Court\"))) %>% \n    mutate_at(vars(contains('team')), list(~str_remove(., \"\\\\@\"))) %>% \n    cbind(x)\n}\n\n#wbb_url <- \"https://www.masseyratings.com/scores.php?s=305973&sub=305973&all=1\" #Original URL (All WBB games)\nwbb_url <- \"https://www.masseyratings.com/scores.php?s=305973&sub=11590&all=1\" #Corrected URL (only D1 WBB games)\nmbb_url <- \"https://www.masseyratings.com/scores.php?s=cb2019&sub=ncaa-d1&all=1&sch=1\" #Original URL (only D1 MBB games)\nurls <- c(wbb_url, mbb_url)\n\nbb_games <- map_dfr(urls, bb_games_process) %>% \n  as_tibble() %>% \n  mutate(sport = if_else(x == wbb_url, \"WBB\", \"MBB\")) %>% \n  select(-x)\n\nbb_games %>% tail(n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 x 8\n  game                  date       win_t~1 win_pts lose_~2 lose_~3 home_~4 sport\n  <chr>                 <date>     <chr>     <int> <chr>     <int> <chr>   <chr>\n1 Texas 81 Lipscomb 66~ 2019-04-04 Texas        81 Lipsco~      66 Neutra~ MBB  \n2 South Florida 77 @De~ 2019-04-05 South ~      77 DePaul       65 DePaul  MBB  \n3 Virginia 63 Auburn 6~ 2019-04-06 Virgin~      63 Auburn       62 Neutra~ MBB  \n4 Texas Tech 61 Michig~ 2019-04-06 Texas ~      61 Michig~      51 Neutra~ MBB  \n5 Virginia 85 Texas Te~ 2019-04-08 Virgin~      85 Texas ~      77 Neutra~ MBB  \n# ... with abbreviated variable names 1: win_team, 2: lose_team, 3: lose_pts,\n#   4: home_team\n```\n:::\n:::\n\n\n\n\nUsing this prepped data, we can identify that there were 543 teams that played in women's games and 650 that played in men's games during the last season.\n\n## Calculating the number of transitive champions\n\nTo identify each \"transitive champion\" in each sport, I looked for where the nation champion lost and pulled a vector of the opponent(s) who beat the champion during the season. I then looped (ugh, I know, I know) through multiple rounds to see who defeated those teams, and so on and so forth. With each loop, I also pasted the number of unique transitive champions who were identified in each round into a data frame for further analysis.\n\n#### Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrounds <- 25\nwbb_n_champ <- \"Baylor\"\nmbb_n_champ <- \"Virginia\"\n```\n:::\n\n\n#### WBB calculations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwbb_t_champs <- bb_games %>% \n  filter(sport == \"WBB\" & lose_team %in% wbb_n_champ) %>% \n  pull(win_team) %>% \n  unique()\n\nwbb_degree_sep <- wbb_t_champs %>% length\n\nfor(x in 1:rounds){\n  wbb_t_champ_beaters <- bb_games %>% \n    filter(sport == \"WBB\" & lose_team %in% wbb_t_champs) %>% \n    pull(win_team) %>% \n    unique()\n  wbb_t_champs <- c(wbb_t_champs, wbb_t_champ_beaters)\n  wbb_t_champs <- wbb_t_champs[!wbb_t_champs == wbb_n_champ] #Remove the national champion from the transitive champs vector\n  wbb_degree_sep <- rbind(wbb_degree_sep, wbb_t_champs %>% unique() %>% length)\n}\n\nwbb_transitive_champs <- wbb_degree_sep %>% \n  as.data.frame() %>% \n  cbind(total_wbb_teams) %>%\n  rename(transitive_champions = V1,\n         total_teams = total_wbb_teams) %>% \n  mutate(degree_of_separation = row_number(),\n         transitive_champ_pct = transitive_champions / total_teams,\n         sport = \"WBB\") \n```\n:::\n\n\n#### MBB calculations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmbb_t_champs <- bb_games %>% \n  filter(sport == \"MBB\" & lose_team %in% mbb_n_champ) %>% \n  pull(win_team) %>% \n  unique()\n\nmbb_degree_sep <- mbb_t_champs %>% length\n\nfor(x in 1:rounds){\n  mbb_t_champ_beaters <- bb_games %>% \n    filter(sport == \"MBB\" & lose_team %in% mbb_t_champs) %>% \n    pull(win_team) %>% \n    unique()\n  mbb_t_champs <- c(mbb_t_champs, mbb_t_champ_beaters)\n  mbb_t_champs <- mbb_t_champs[!mbb_t_champs == mbb_n_champ] #Remove the national champion from the transitive champs vector\n  mbb_degree_sep <- rbind(mbb_degree_sep, mbb_t_champs %>% unique() %>% length)\n}\n\nmbb_transitive_champs <- mbb_degree_sep %>% \n  as.data.frame() %>% \n  cbind(total_mbb_teams) %>%\n  rename(transitive_champions = V1,\n         total_teams = total_mbb_teams) %>% \n  mutate(degree_of_separation = row_number(),\n         transitive_champ_pct = transitive_champions / total_teams,\n         sport = \"MBB\") \n```\n:::\n\n\n#### Bringing the transitive champion data together\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransitive_champs <- bind_rows(\n  wbb_transitive_champs,\n  mbb_transitive_champs) %>% \n  mutate(sport = as_factor(sport))\n```\n:::\n\n\n## Results!\n\nFor the 2018-2019, I identified the following number of \"transitive champs\":\n\n-   Women's Basketball: **360 transitive champions**\n\n-   Men's Basketball: **358 transitive champions**\n\nEach sport reached the total number of transitive champs within 8 degrees of separation of the national champion. However, transitive champs comprise 66% of total women's Division I basketball teams compared to 55% in the men's game, as the plot below shows. This could be due to an effect of major conference teams playing each other more in men's basketball (limiting opportunities for minor conference teams to grab a transitive championship), but that hypothesis would have to be tested in further analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransitive_champs %>% \n  ggplot(aes(x=degree_of_separation, y=transitive_champ_pct, color = sport)) +\n  labs(title = \"How many basketball teams beat a team, who beat a team, \\nwho.... beat the national champ?\",\n       subtitle = \"Analysis of 2018-2019 college basketball games\") + \n  geom_line() +\n  geom_point() +\n  theme_minimal() +\n  facet_grid(rows = vars(sport), scales = \"free\") +\n  scale_x_continuous(\"Degrees of Separation from Actual National Champion\") +\n  scale_y_continuous(\"Cumulative % of Teams\", labels = scales::percent) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/t_champs plot-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}